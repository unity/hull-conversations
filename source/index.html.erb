<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <title>Hull Conversations Widget</title>


    <link rel="stylesheet" href="//hullstrap.s3.amazonaws.com/stylesheets/hullstrap.css">
    <!-- <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="/stylesheets/style.css">

    <script type="text/javascript" src="//use.typekit.net/jyf4qww.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="//hullstrap.s3.amazonaws.com/javascripts/hullstrap.js"></script>

    <script src="http://hull-js.s3.amazonaws.com/develop/hull.js"></script>
    <script src="http://js.hull.dev/dist/develop/hull.js"></script>


    <script src="/javascripts/vendors.js"></script>
    <script src="/javascripts/app.js"></script>

    <script type="text/x-template" data-hull-template="conversation_form/form">
      <form class="navbar-form plus">
        {{#if loggedIn}}
          <i class="icon icon-plus"></i>          
          <input type="text" name="name" placeholder="New thread"></input>
          <button class='info' data-hull-action="create">↵</button>
        {{else}}
          <div data-hull-widget="login_button@hull"></div>
        {{/if}}
      </form>
    </script>
    <script type="text/x-template" data-hull-template="conversations/thread/form">
      {{#if loggedIn}}
        <form data-hull-item="form">
          <div class='media'>
            <div class="pull-left">
              <img class="media-object avatar" src="{{me.picture}}" alt="{{me.name}}">
            </div>
            <div class="media-body message_entry">
              <textarea name='description' class="input-block-level" rows="3" placeholder="Send a message... "></textarea>
              <button data-hull-action="message" data-hull-id="{{conversation.id}}" class="btn btn-small">
                <i class="icon icon-reply"></i>
                {{#if isNew}}Send{{else}}Reply{{/if}}
              </button>
            </div>
          </div>
        </form>
      {{else}}
        <div data-hull-widget="login_button@hull"></div>
      {{/if}}
    </script>
    <script type="text/x-template" data-hull-template="conversations/thread/thread">
      {{#if errors.conversation}}
        <div class="alert alert-error">Unable to retrieve the conversation</div>
      {{else}}
        {{#if conversation}}

          <div class="page-header">
            <div class='participants'>
              {{#conversation.participants}}
                <img class="avatar" data-toggle="tooltip" title="{{name}}" data-placement="bottom" src="{{picture}}" width="50" alt="{{name}}">
              {{/conversation.participants}}
            </div>
            <h5>
              <div class='pull-right'>
                {{#if conversation.isDeletable}}
                  <button data-hull-action="delete" data-hull-id="{{conversation.id}}" class="btn btn-link btn-small">
                    <i class="icon icon-trash"></i>
                    Delete conversation
                  </button>
                {{/if}}
                <small><strong>{{conversation.messages_count_unread}} unread</strong> / {{conversation.messages_count}} messages</small>
              </div>
              {{conversation.name}}
            </h5>
          </div>

          {{#if conversation.notification_enabled}}
            <form class="hull-conversation__notifications">
              <input type="checkbox" data-hull-action="notification" name="user_notification" {{#if conversation.notification_enabled_user}}checked{{/if}}> notify
            </form>
          {{/if}}


            {{#if messages}}
              <ul class="media-list">
                {{#messages}}
                  <li class="media {{#if isMe}}mine{{/if}}" data-hull-message-id="{{id}}">
                    <div class="pull-left">
                      <img class="avatar media-object" src="{{actor.picture}}" width="50" alt="{{actor.name}}">
                    </div>
                    <div class="media-body">
                      <small class="muted pull-right">{{formatTime updated_at "h:mm A"}}</small>
                      <h6 class="media-heading">
                        {{#if isNew}}
                          <small class="new_message">
                            <i class="icon icon-fire"></i>
                          </small>
                        {{/if}}
                        {{actor.name}}
                      </h6>
                      <p> {{body}} </p>
                      <div class="hull-messages__actions">
                          {{#if isDeletable}}
                            <small>
                              <a href="#" class='link' data-hull-action="deleteMsg" data-hull-id="{{id}}">Delete</a>
                            </small>
                          {{/if}}
                      </div>
                    </div>
                  </li>
                {{/messages}}
              </ul>
            {{/if}}

            {{> conversations.thread.form}}
        {{/if}}
      {{/if}}
    </script>
    <script type="text/x-template" data-hull-template="conversations/list/list">
      {{#each conversations}}
        <div class="media item" data-hull-action="select" data-hull-id="{{id}}">
          <a class="pull-left" href="#">
            <img class="media-object avatar" src="{{actor.picture}}">
          </a>
          <div class="media-body">
            <h5 class="media-heading">{{name}}</h5>
            <small><i class="icon icon-power"></i> {{messages_count}}</small>
            ·
            <small><i class="icon icon-sun_stroke"></i> {{formatTime updated_at 'h:mm a'}}</small>
          </div>
        </div>
      {{else}}
        {{#if errors.conversations}}
          <div class="alert alert-error">
            Unable to retrieve the conversations.
          </div>
        {{/if}}
      {{/each}}
    </script>


    <script type="text/x-template" data-hull-template="subjects/list">
      <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <ul class="nav pull-right">
              <li class="dropdown">
                <a href="" title="" class="dropdown-toggle" data-toggle="dropdown">
                  Topic
                  <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                  <li><a href='#' data-hull-action='select' data-hull-uid=''> All Topics</a> </li>
                  <li class="divider"></li>
                  {{#each subjects}}
                    <li> <a href='#' data-hull-action='select' data-hull-uid='{{name}}'> {{name}} </a> </li>
                  {{/each}}
                </ul>
              </li>
            </ul>
            <ul class='nav'>
              <li>
                <a>Hull Conversations</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div data-hull-widget="conversations/list@hull" class="topics" data-hull-visibility="public" data-hull-uid="{{name}}"></div>
      <div class="navbar navbar-fixed-bottom">
        <div data-hull-widget="conversation_form" class="navbar-inner new_conversation">
      </div>
    </script>

  </head>

  <body>
    <!-- <a href="http://github.com/hull/hull-conversations" class="github-ribbon">Fork me on GitHub</a> -->

    <div class="sidebar" data-hull-widget="subjects"> </div>

    <div class="conversation_container">
      <div class="conversation" data-hull-widget="conversations/thread@hull"></div>
    </div>

  </body>
</html>
